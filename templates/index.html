<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Community Day - AI Guide</title>
    <!-- Favicon Links -->
    <link rel="icon" href="https://ccd.bhopal.dev/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://ccd.bhopal.dev/favicon.ico" type="image/x-icon">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .chat-message {
            max-width: 85%;
            padding: 0.75rem 1.25rem;
            border-radius: 1.25rem;
            margin-bottom: 0.5rem;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .user-message {
            background: linear-gradient(to right, #fb923c, #f97316); /* orange-400 to orange-500 */
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .bot-message {
            background: #ffffff; /* white */
            color: #1e2b3b; /* slate-800 */
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .bot-message a {
            color: #2563eb; /* blue-600 */
            text-decoration: underline;
            font-weight: 600;
        }
        .bot-message ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .bot-message strong {
            color: #1d4ed8; /* blue-700 */
        }
        .bot-message p {
            margin-bottom: 0.5rem;
        }
        /* Hide scrollbar but keep functionality */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col h-screen">
    <!-- Header -->
    <header class="w-full flex items-center justify-between px-6 py-3 bg-gradient-to-r from-orange-400 via-green-400 to-blue-500 shadow-md z-10">
        <img src="https://ccd.bhopal.dev/logo.png" alt="Cloud Community Day Logo" class="h-10 w-auto">
        <a href="https://ccd.bhopal.dev/" target="_blank" class="text-white font-semibold bg-green-400 hover:bg-green-500 px-4 py-2 rounded-lg shadow transition-transform hover:scale-105">Official Site</a>
    </header>

    <!-- Main Chat Container -->
    <main class="flex-1 p-4 overflow-hidden">
        <!-- This div now has a fixed height and won't grow -->
        <div class="w-full max-w-3xl h-full mx-auto bg-white shadow-2xl flex flex-col rounded-lg">
            
            <!-- This is the message area that will scroll -->
            <div id="chat-messages" class="flex-1 p-6 space-y-4 overflow-y-auto flex flex-col">
                <div class="chat-message bot-message">
                    Hi! I'm the official AI Guide for GCCD Bhopal. Ask me anything about the event, or try one of the suggestions below!
                </div>
            </div>
            
            <!-- Input Area Container -->
            <div class="p-4 bg-gray-100 border-t border-gray-200 rounded-b-lg">
                <!-- Suggestion Chips Section -->
                <div class="flex items-center gap-2 overflow-x-auto pb-3 hide-scrollbar">
                    <span class="text-sm font-bold text-gray-500 whitespace-nowrap">‚ú® Try:</span>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        Who are the speakers?
                    </button>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        What is the agenda?
                    </button>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        How is it beneficial for me as a student?
                    </button>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        What is are the technologies we will be discussing about?
                    </button>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        Will there be food?
                    </button>
                    <button class="suggestion-chip bg-gray-200 hover:bg-gray-300 text-xs text-gray-700 font-semibold py-1 px-3 rounded-full transition whitespace-nowrap">
                        What is meant by networking?
                    </button>
                </div>

                <form id="chat-form" class="flex items-center">
                    <input type="text" id="chat-input" placeholder="Ask 'How will this event help me?'" class="flex-1 bg-white border border-gray-300 text-gray-800 rounded-l-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-5 rounded-r-lg">Send</button>
                </form>
                 <!-- Location Link (now safely part of the flow) -->
                <div class="text-center mt-3">
                    <a href="https://maps.app.goo.gl/1qNi4KHQiivgESWt8" target="_blank" class="text-xs text-blue-800 bg-yellow-200 px-3 py-1 rounded-full shadow hover:bg-yellow-300 transition font-semibold">
                        üìç Location: Minto Hall, Bhopal
                    </a>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- Configure marked.js to open links in a new tab ---
        const renderer = new marked.Renderer();
        renderer.link = function(href, title, text) {
            return `<a target="_blank" href="${href}" title="${title || ''}">${text}</a>`;
        };
        marked.setOptions({
            renderer: renderer
        });

        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const suggestionChips = document.querySelectorAll('.suggestion-chip');

        // Logic for Suggestion Chips
        suggestionChips.forEach(chip => {
            chip.addEventListener('click', () => {
                const suggestionText = chip.textContent.trim();
                const commandText = suggestionText.replace('Suggest a ', '').replace('Suggest an ', '');
                chatInput.value = commandText;
                chatForm.dispatchEvent(new Event('submit'));
            });
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            chatInput.value = '';
            addTypingIndicator();

            try {
                const response = await fetch('http://127.0.0.1:5000/ask', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message }),
                });

                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                
                const data = await response.json();
                
                removeTypingIndicator();
                addMessage(data.reply, 'bot');

            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, I encountered an error. Please try again.', 'bot');
                console.error("Chatbot Error:", error);
            }
        });
        
        function addMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message ${sender}-message`;
            if (sender === 'bot') {
                messageElement.innerHTML = marked.parse(text);
            } else {
                messageElement.textContent = text;
            }
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.id = 'typing-indicator';
            typingElement.className = 'chat-message bot-message';
            typingElement.innerHTML = '<span class="animate-pulse">‚óè ‚óè ‚óè</span>';
            chatMessages.appendChild(typingElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingElement = document.getElementById('typing-indicator');
            if (typingElement) typingElement.remove();
        }
    </script>
</body>
</html>
